let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,s=e[n].value,o=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach((n,r)=>{t.append(createRestaurantHTML(n,r,e.length))}),addMarkersToMap()}),createRestaurantHTML=((e,t,n)=>{const r=document.createElement("li"),s=`\n\t\t<picture>\n\t\t\t<source srcset="/img/${e.id}-540_sml_2x.jpg 2x">\n\t\t\t<img src="/img/${e.id}-280_sml.jpg" alt="Image of ${e.name} restaurant">\n\t\t</picture>\n\t\t<h2>${e.name}</h2>\n\t\t<p>${e.neighborhood}</p>\n\t\t<p>${e.address}</p>\n\t\t<a href="./restaurant.html?id=${e.id}" aria-label="More information on ${e.name} restaurant" role="button">View Details</a>\n\t`;return r.innerHTML=s,r.setAttribute("aria-posinset",t+1),r.setAttribute("aria-setsize",n),r}),mapMarkerForRestaurant=((e,t)=>{return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),window.onload=function(){document.querySelector("iframe").title="Google Maps"},initServiceWorker=(()=>{if(!navigator.serviceWorker)return;const e=function(e){console.log("service worker update ready..."),e.postMessage({action:"skipWaiting"})},t=function(t){t.addEventListener("statechange",function(){"installed"==t.state&&e(t)})};navigator.serviceWorker.register("sw.js").then(function(n){if(console.log("Service worker registered"),!navigator.serviceWorker.controller)return;if(n.waiting)return void e(n.waiting);let r;n.installing&&t(n.installing),n.addEventListener("updatefound",function(){t(n.installing)}),navigator.serviceWorker.addEventListener("controllerchange",function(){r||(window.location.reload(),r=!0)})},function(e){console.log("Service worker registration failed with message: "+e)})}),initServiceWorker();